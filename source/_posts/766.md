---
title: å“ªå’ç›‘æ§å¼€æºã€è½»é‡ã€æ˜“ç”¨çš„æœåŠ¡å™¨ç›‘æ§ä¸è¿ç»´å·¥å…·
tags:
  - 
categories:
  - 
date: 2024-12-08 00:00:00
---

> 

<!-- more -->

## ä»‹ç»

## ç‰¹ç‚¹

ä¸€é”®å®‰è£…

æ”¯æŒä¸€é”®å®‰è£…é¢æ¿å’Œç›‘æ§æœåŠ¡ï¼Œæ“ä½œä¾¿æ·ã€‚å…¼å®¹ä¸»æµç³»ç»Ÿï¼ŒåŒ…æ‹¬ Linuxã€Windowsã€macOSã€OpenWRT ä»¥åŠç¾¤æ™–ã€‚

å®æ—¶ç›‘æ§

æ”¯æŒåŒæ—¶ç›‘æ§å¤šä¸ªæœåŠ¡å™¨çš„çŠ¶æ€ï¼Œæä¾›å†å²ç½‘ç»œçŠ¶æ€å’Œå»¶è¿Ÿå›¾è¡¨ï¼Œç›‘æ§ç½‘é¡µã€ç«¯å£å¯ç”¨æ€§å’Œ SSL è¯ä¹¦çŠ¶æ€ã€‚æ”¯æŒæ•…éšœå’Œæµé‡ç­‰çŠ¶æ€å‘Šè­¦ï¼Œå¯é€šè¿‡ Telegramã€é‚®ä»¶ã€å¾®ä¿¡ç­‰å¤šç§æ–¹å¼æé†’ã€‚

è½»æ¾è¿ç»´

æä¾› API è·å–æœåŠ¡å™¨çŠ¶æ€ï¼Œæ”¯æŒWebSSHã€DDNS å’Œæµé‡ç›‘æ§ã€‚å¯è®¾ç½®å®šæ—¶å’Œè§¦å‘ä»»åŠ¡ï¼Œå¹¶æ‰¹é‡æ‰§è¡ŒæœåŠ¡å™¨ä»»åŠ¡ã€‚

## æœåŠ¡ç«¯çš„éƒ¨ç½²

å‡†å¤‡å·¥ä½œ  

æ­å»ºä¸€ä¸ªå“ªå’ç›‘æ§ï¼Œä½ éœ€è¦ï¼š
1. ä¸€å°å¯ä»¥è¿æ¥å…¬ç½‘çš„æœåŠ¡å™¨ï¼Œé˜²ç«å¢™å’Œå®‰å…¨ç­–ç•¥éœ€è¦æ”¾è¡Œ 8008 å’Œ 5555 ç«¯å£ï¼Œå¦åˆ™ä¼šæ— æ³•è®¿é—®å’Œæ— æ³•æ¥æ”¶æ•°æ®ã€‚å•æ ¸ 512MB å†…å­˜çš„æœåŠ¡å™¨é…ç½®å°±è¶³ä»¥æ»¡è¶³å¤§å¤šæ•°ä½¿ç”¨åœºæ™¯ã€‚
2. ä¸€ä¸ªå·²ç»è®¾ç½®å¥½ A è®°å½•ï¼ŒæŒ‡å‘ Dashboard æœåŠ¡å™¨ IP çš„åŸŸåã€‚
::: tip 
å¦‚æœä½ æƒ³ä½¿ç”¨ CDNï¼Œè¯·å‡†å¤‡ä¸¤ä¸ªåŸŸåï¼Œä¸€ä¸ªé…ç½®å¥½ CDN ç”¨ä½œå…¬å¼€è®¿é—®ï¼ŒCDN éœ€è¦æ”¯æŒ WebSocket åè®®ï¼›å¦ä¸€ä¸ªåŸŸåä¸è¦ä½¿ç”¨ CDNï¼Œç”¨ä½œ Agent ç«¯ä¸ Dashboard çš„é€šä¿¡ã€‚  

æœ¬æ–‡æ¡£åˆ†åˆ«ä»¥ "dashboard.example.com" å’Œ "data.example.com" ä¸¤ä¸ªåŸŸåæ¥æ¼”ç¤ºã€‚
:::
3. ä¸€ä¸ª Github è´¦å·ï¼ˆæˆ–ï¼šGitlabã€Giteeï¼‰ã€‚

**æœ¬æ–‡æ¡£å°†ä»¥å®å¡”é¢æ¿åä»£ Dashboard çš„è¿‡ç¨‹ä½œä¸ºç¤ºèŒƒï¼Œéšç€æœªæ¥ç‰ˆæœ¬çš„å˜åŒ–ï¼Œéƒ¨åˆ†åŠŸèƒ½çš„å…¥å£å¯èƒ½ä¼šå‘ç”Ÿæ”¹å˜ï¼Œæœ¬æ–‡æ¡£ä»…ä¾›å‚è€ƒã€‚**  
:::warning  
æœ¬é¡¹ç›®å¹¶ä¸ä¾èµ–å®å¡”ï¼Œä½ å¯ä»¥é€‰æ‹©ä½¿ç”¨ä½ å–œæ¬¢çš„ä»»ä½•æœåŠ¡å™¨é¢æ¿ï¼Œæˆ–æ‰‹åŠ¨å®‰è£… Nginx æˆ– Caddy æ¥é…ç½® SSL å’Œåä»£ã€‚  
å¦‚æœä½ è®¤ä¸ºæ²¡æœ‰å¿…è¦ä½¿ç”¨ 80ã€443 ç«¯å£æ¥è®¿é—® Dashboardï¼Œä½ ç”šè‡³ä¸éœ€è¦å®‰è£… Nginx å°±å¯ä»¥ç›´æ¥ä½¿ç”¨å®‰è£…è„šæœ¬å®‰è£…å¹¶è¿è¡Œå“ªå’ç›‘æ§ã€‚  
:::  

## è·å– Github çš„ Client ID å’Œå¯†é’¥

å“ªå’ç›‘æ§æ¥å…¥ Githubã€Gitlabã€Gitee ä½œä¸ºåå°ç®¡ç†å‘˜è´¦å·ã€‚  
1. é¦–å…ˆæˆ‘ä»¬éœ€è¦æ–°å»ºä¸€ä¸ªéªŒè¯åº”ç”¨ï¼Œä»¥ Github ä¸ºä¾‹ï¼Œç™»å½• Github åï¼Œæ‰“å¼€ https://github.com/settings/developers ï¼Œä¾æ¬¡é€‰æ‹©â€œOAuth Appsâ€ - â€œNew OAuth Appâ€ã€‚  
`Application name` - éšæ„å¡«å†™ã€‚  
`Homepage URL` - å¡«å†™é¢æ¿çš„è®¿é—®åŸŸåï¼Œå¦‚ï¼š"http://dashboard.example.com"ï¼ˆä½ çš„åŸŸåï¼‰ã€‚  
`Authorization callback URL` - å¡«å†™å›è°ƒåœ°å€ï¼Œå¦‚ï¼š"http://dashboard.example.com/oauth2/callback"ï¼ˆä¸è¦å¿˜è®°`/oauth2/callback`ï¼‰ã€‚  
2. ç‚¹å‡» â€œRegister applicationâ€ã€‚  
3. ä¿å­˜é¡µé¢ä¸­çš„ Client IDï¼Œç„¶åç‚¹å‡» â€œGenerate a new client secretâ€œï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ Client Secretï¼Œæ–°å»ºçš„å¯†é’¥ä»…ä¼šæ˜¾ç¤ºä¸€æ¬¡ï¼Œ**è¯·å¦¥å–„ä¿å­˜**ã€‚

## ä½¿ç”¨ Cloudflare Access ä½œä¸º OAuth2 æä¾›æ–¹

å¯¹äºä½äºä¸­å›½å¤§é™†çš„ç”¨æˆ·ï¼Œç›´æ¥è¿æ¥åˆ° GitHub å¯èƒ½ä¼šé‡åˆ°å›°éš¾ã€‚å¦‚æœæ‚¨åœ¨ä½¿ç”¨ GitHubã€GitLab æˆ– Gitee ä½œä¸ºç®¡ç†å‘˜è´¦æˆ·ç™»å½•æ—¶é‡åˆ°é—®é¢˜ï¼Œå»ºè®®åˆ‡æ¢åˆ°ä½¿ç”¨ [Cloudflare Access ä½œä¸º OAuth2 æä¾›æ–¹](/guide/q8.html) è¿›è¡Œç™»å½•ã€‚

### æ–°å»º SaaS-OIDC åº”ç”¨æµç¨‹

:::warning
ä»¥ä¸‹æ­¥éª¤é€‚ç”¨äºå·²ç»å¼€å§‹ä½¿ç”¨ Zero Trust çš„ç”¨æˆ·ã€‚å¦‚æœæ‚¨å°šæœªä½¿ç”¨è¿‡ Cloudflare Zero Trustï¼Œå¼ºçƒˆå»ºè®®æ‚¨é¦–å…ˆé˜…è¯» [Cloudflare Access ä½œä¸º OAuth2 æä¾›æ–¹çš„ä½¿ç”¨æŒ‡å—](/guide/q8.html)ï¼Œä»¥äº†è§£ Cloudflare Access çš„é…ç½®ç¤ºä¾‹å’Œæµç¨‹ã€‚
:::

1. å‰å¾€ [Zero Trust Dashboard](https://one.dash.cloudflare.com)ï¼Œä½¿ç”¨ Cloudflare è´¦å·ç™»å½•ã€‚
2. `My Team` -> `Users` -> `<å…·ä½“ç”¨æˆ·>` -> è·å– `User ID` å¹¶ä¿å­˜ã€‚
3. `Access` -> `Application` -> `Add an Application`ã€‚
4. é€‰æ‹© `SaaS`ï¼Œåœ¨ `Application` ä¸­è¾“å…¥è‡ªå®šä¹‰çš„åº”ç”¨åç§°ï¼ˆä¾‹å¦‚ nezhaï¼‰ï¼Œé€‰æ‹© `OIDC` åç‚¹å‡» `Add application`ã€‚
5. `Scopes` é€‰æ‹© `openid`, `email`, `profile`, `groups`ã€‚
6. `Redirect URLs` å¡«å†™ä½ çš„ callback åœ°å€ï¼Œä¾‹å¦‚ `https://dashboard.example.com/oauth2/callback`ã€‚
7. ä¿å­˜ `Client ID`ã€`Client Secret`ã€`Issuer` åœ°å€ä¸­åè®®ä¸åŸŸåçš„éƒ¨åˆ†ï¼Œä¾‹å¦‚ `https://xxxxx.cloudflareaccess.com`ã€‚

**å¦‚ä½¿ç”¨æ­¤æ–¹å¼ï¼Œå®‰è£… Dashboard å®Œæˆåï¼Œéœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶ `/opt/nezha/dashboard/data/config.yaml`ï¼Œå°† `Endpoint` é…ç½®ä¿®æ”¹ä¸ºä¹‹å‰ä¿å­˜çš„ `Issuer` åœ°å€ï¼Œä¾‹å¦‚ `https://xxxxx.cloudflareaccess.com`ï¼Œä¿å­˜åéœ€é‡å¯ Dashboardã€‚**   

## OIDC éªŒè¯é…ç½®ï¼ˆå¯é€‰ï¼‰

å“ªå’æ”¯æŒè‡ªå®šä¹‰ OIDC éªŒè¯ç™»å½•ã€‚æœ‰å…³é…ç½®è¯¦æƒ…ï¼Œè¯·å‚è€ƒæ–‡æ¡£ï¼š[å¯ç”¨ OIDC è®¤è¯](/guide/q10.html)ã€‚

## åœ¨æœåŠ¡å™¨ä¸­å®‰è£… Dashboard

åœ¨é¢æ¿æœåŠ¡å™¨ä¸­ï¼Œè¿è¡Œå®‰è£…è„šæœ¬ï¼š
```bash
curl -L https://raw.githubusercontent.com/nezhahq/scripts/main/install.sh -o nezha.sh && chmod +x nezha.sh && sudo ./nezha.sh
```  
å¦‚æœä½ çš„é¢æ¿æœåŠ¡å™¨ä½äºä¸­å›½å¤§é™†ï¼Œå¯ä»¥ä½¿ç”¨é•œåƒï¼š
```bash
curl -L https://gitee.com/naibahq/scripts/raw/main/install.sh -o nezha.sh && chmod +x nezha.sh && sudo CN=true ./nezha.sh
```

ç­‰å¾… Docker å®‰è£…å®Œæ¯•åï¼Œåˆ†åˆ«è¾“å…¥ä»¥ä¸‹å€¼ï¼š
- `OAuthæä¾›å•†` -  githubã€cloudflareã€gitlabã€gitee ä¸­é€‰æ‹©ä¸€ä¸ªã€‚
- `Client ID` - ä¹‹å‰ä¿å­˜çš„ Client IDã€‚
- `Client Secret` - ä¹‹å‰ä¿å­˜çš„ Client Secretã€‚
- `ç”¨æˆ·å` - OAuth æä¾›å•†ä¸­çš„ç”¨æˆ·å/User IDã€‚
- `ç«™ç‚¹æ ‡é¢˜` - è‡ªå®šä¹‰ç«™ç‚¹æ ‡é¢˜ã€‚
- `è®¿é—®ç«¯å£` - å…¬å¼€è®¿é—®ç«¯å£ï¼Œå¯è‡ªå®šä¹‰ï¼Œé»˜è®¤ 8008ã€‚
- `Agentçš„é€šä¿¡ç«¯å£` - Agent ä¸ Dashboard çš„é€šä¿¡ç«¯å£ï¼Œé»˜è®¤ 5555ã€‚

è¾“å…¥å®Œæˆåï¼Œç­‰å¾…æ‹‰å–é•œåƒã€‚  
å®‰è£…ç»“æŸåï¼Œå¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œæ­¤æ—¶ä½ å¯ä»¥è®¿é—®åŸŸå+ç«¯å£å·ï¼Œå¦‚ â€œhttp://dashboard.example.com:8008â€ æ¥æŸ¥çœ‹é¢æ¿ã€‚

å°†æ¥å¦‚æœéœ€è¦å†æ¬¡è¿è¡Œè„šæœ¬ï¼Œå¯ä»¥è¿è¡Œï¼š
```bash
./nezha.sh
``` 
æ¥æ‰“å¼€ç®¡ç†è„šæœ¬ã€‚  

## é…ç½®åå‘ä»£ç†

åœ¨å®å¡”é¢æ¿ä¸­æ–°å»ºä¸€ä¸ªç«™ç‚¹ï¼ŒåŸŸåå¡«å†™å…¬å¼€è®¿é—®åŸŸåï¼Œå¦‚ â€œhttp://dashboard.example.comâ€œ ï¼Œç„¶åç‚¹å‡»â€œè®¾ç½®â€è¿›å…¥ç«™ç‚¹è®¾ç½®é€‰é¡¹ï¼Œé€‰æ‹©â€œåå‘ä»£ç†â€ - â€œæ–°å»ºåå‘ä»£ç†â€ã€‚

è‡ªå®šä¹‰ä¸€ä¸ªä»£ç†åç§°ï¼Œåœ¨ä¸‹æ–¹â€œç›®æ ‡ URLâ€ä¸­å¡«å…¥ `http://127.0.0.1` ç„¶åç‚¹å‡»â€œä¿å­˜â€ã€‚

æ‰“å¼€åˆšåˆšæ–°å»ºçš„åå‘ä»£ç†å³è¾¹çš„â€œé…ç½®æ–‡ä»¶â€ï¼Œå°†é…ç½®æ–‡ä»¶æ›¿æ¢ä¸ºä»¥ä¸‹å†…å®¹ï¼š
```nginx
#PROXY-START/
location / {
    proxy_pass http://127.0.0.1:8008;
    proxy_set_header Host $http_host;
    proxy_set_header      Upgrade $http_upgrade;
}
location ~ ^/(ws|terminal/.+|file/.+)$ {
    proxy_pass http://127.0.0.1:8008;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "Upgrade";
    proxy_set_header Host $http_host;
}
#PROXY-END/
```
ç‚¹å‡»â€œä¿å­˜â€ã€‚  
ç°åœ¨ï¼Œä½ åº”è¯¥å¯ä»¥ç›´æ¥ä½¿ç”¨åŸŸåï¼Œå¦‚ï¼šâ€œhttp://dashboard.example.comâ€œ æ¥è®¿é—®é¢æ¿äº†ã€‚  

### æ‰©å±•å†…å®¹ï¼š 

CaddyServer v1ï¼ˆv2 æ— éœ€ç‰¹åˆ«é…ç½®ï¼‰ï¼š

```caddy
proxy /ws http://ip:8008 {
    websocket
    header_upstream -Origin
}
proxy /terminal/* http://ip:8008 {
    websocket
    header_upstream -Origin
}
proxy /file/* http://ip:8008 {
    websocket
    header_upstream -Origin
}
```

## åœ¨å®å¡”é¢æ¿ä¸­é…ç½® SSL

é¦–å…ˆï¼Œå…ˆæš‚æ—¶å…³é—­åå‘ä»£ç†ã€‚  
æ­£å¦‚åœ¨å…¶ä»–ç½‘ç«™ä¸­é…ç½® SSL è¯ä¹¦ä¸€æ ·ï¼Œè¿›å…¥ç«™ç‚¹è®¾ç½®ä¸­çš„ â€œSSLâ€ï¼Œä½ å¯ä»¥é€‰æ‹©è‡ªåŠ¨ç”³è¯· LetÂ´s Encrypt è¯ä¹¦æˆ–æ‰‹åŠ¨é…ç½®å·²æœ‰çš„è¯ä¹¦ã€‚  
å®Œæˆ SSL çš„è®¾ç½®åï¼Œä½ éœ€è¦å›åˆ° https://github.com/settings/developers ï¼Œç¼–è¾‘ä¹‹å‰åˆ›å»ºçš„éªŒè¯åº”ç”¨ç¨‹åºï¼Œå°†ä¹‹å‰æˆ‘ä»¬å¡«å…¥çš„ "Homepage URL" å’Œ "Authorization callback URL" ä¸­çš„åŸŸåå…¨éƒ¨ä» `http` æ”¹ä¸º `https`ï¼Œå¦‚ï¼š"https://dashboard.example.com" å’Œ "https://dashboard.example.com/oauth2/callback" ï¼Œ**ä¸æ›´æ”¹æ­¤é¡¹å¯èƒ½ä¼šå¯¼è‡´ä½ æ— æ³•ç™»å½•é¢æ¿åå°**ã€‚  

## æ›´æ–° Dashboard

è¿è¡Œè„šæœ¬ `./nezha.sh` ï¼Œé€‰æ‹©é‡å¯é¢æ¿å¹¶æ›´æ–°ã€‚

## å®¢æˆ·ç«¯çš„å®‰è£…

**å“ªå’ç›‘æ§çš„è¢«æ§ç«¯æœåŠ¡è¢«ç§°ä¸º Agentï¼Œæœ¬æ–‡æ¡£å°†ä»‹ç»å¦‚ä½•åœ¨è¢«æ§ç«¯æœåŠ¡å™¨ä¸Šå®‰è£… Agentï¼Œå¹¶ä¸ Dashboard è¿æ¥ã€‚**  
::: tip  
Agent äºŒè¿›åˆ¶æ–‡ä»¶ä»“åº“åœ°å€ä¸ºï¼š<https://github.com/nezhahq/agent/releases>
:::

## ä¸€é”®å®‰è£… Agent

å“ªå’ç›‘æ§æ”¯æŒåœ¨ Windows å’Œ Linux ä¸Šä¸€é”®å®‰è£… Agentã€‚éµå¾ªæœ¬æ–‡æ¡£çš„æ­¥éª¤ï¼Œä½ å¯ä»¥å¾ˆè½»æ¾åœ°åœ¨æœåŠ¡å™¨ä¸Šéƒ¨ç½²å®ƒã€‚  

### å‡†å¤‡å·¥ä½œ

ä½ éœ€è¦æå‰åœ¨ç®¡ç†é¢æ¿ä¸­è®¾ç½®å¥½é€šä¿¡åŸŸåï¼Œæ­¤åŸŸåä¸å¯ä»¥æ¥å…¥ CDNã€‚æœ¬æ–‡æ¡£ä»¥ç¤ºä¾‹é€šä¿¡åŸŸå â€œdata.example.comâ€ ä¸ºä¾‹ã€‚  
è¿›å…¥åå°ç®¡ç†é¢æ¿ï¼Œè½¬åˆ°â€œè®¾ç½®â€é¡µï¼Œåœ¨â€œæœªæ¥å…¥ CDN çš„é¢æ¿æœåŠ¡å™¨åŸŸå/IPâ€é¡¹ä¸­å¡«å…¥é€šä¿¡åŸŸåï¼Œç„¶åç‚¹å‡»"ä¿å­˜"ã€‚

### åœ¨ Linux ä¸­ä¸€é”®å®‰è£…

1. é¦–å…ˆåœ¨ç®¡ç†é¢æ¿ä¸­æ·»åŠ ä¸€å°æœåŠ¡å™¨ã€‚
2. ç‚¹å‡»æ–°æ·»åŠ çš„æœåŠ¡å™¨æ—çš„ç»¿è‰² Linux å›¾æ ‡æŒ‰é’®ï¼Œå¤åˆ¶ä¸€é”®å®‰è£…å‘½ä»¤ã€‚
3. åœ¨è¢«æ§ç«¯æœåŠ¡å™¨ä¸­è¿è¡Œå¤åˆ¶çš„ä¸€é”®å®‰è£…å‘½ä»¤ï¼Œç­‰å¾…å®‰è£…å®Œæˆåè¿”å›åˆ° Dashboard ä¸»é¡µæŸ¥çœ‹æœåŠ¡å™¨æ˜¯å¦ä¸Šçº¿ã€‚

### åœ¨ macOS ä¸­ä¸€é”®å®‰è£…

1. é¦–å…ˆåœ¨ç®¡ç†é¢æ¿ä¸­æ·»åŠ ä¸€å°æœåŠ¡å™¨ã€‚
2. ç‚¹å‡»æ–°æ·»åŠ çš„æœåŠ¡å™¨æ—çš„ç»¿è‰² Apple å›¾æ ‡æŒ‰é’®ï¼Œå¤åˆ¶ä¸€é”®å®‰è£…å‘½ä»¤ã€‚
3. åœ¨è¢«æ§ç«¯æœåŠ¡å™¨ä¸­è¿è¡Œå¤åˆ¶çš„ä¸€é”®å®‰è£…å‘½ä»¤ï¼Œç­‰å¾…å®‰è£…å®Œæˆåè¿”å›åˆ° Dashboard ä¸»é¡µæŸ¥çœ‹æœåŠ¡å™¨æ˜¯å¦ä¸Šçº¿ã€‚

### åœ¨ Windows ä¸­ä¸€é”®å®‰è£…

1. é¦–å…ˆåœ¨ç®¡ç†é¢æ¿ä¸­æ·»åŠ ä¸€å°æœåŠ¡å™¨ã€‚
2. ç‚¹å‡»æ–°æ·»åŠ çš„æœåŠ¡å™¨æ—çš„ç»¿è‰² Windows å›¾æ ‡æŒ‰é’®ï¼Œå¤åˆ¶ä¸€é”®å®‰è£…å‘½ä»¤ã€‚
3. è¿›å…¥ Windows æœåŠ¡å™¨ï¼Œè¿è¡Œ PowerShellï¼Œåœ¨ PowerShell ä¸­è¿è¡Œå¤åˆ¶çš„å®‰è£…å‘½ä»¤ã€‚
4. å¦‚é‡åˆ°ç¡®è®¤ã€Œæ‰§è¡Œç­–ç•¥å˜æ›´ã€è¯·é€‰æ‹© Yã€‚
5. ç­‰å¾…å®‰è£…å®Œæˆåè¿”å› Dashboard ä¸»é¡µæŸ¥çœ‹æœåŠ¡å™¨æ˜¯å¦ä¸Šçº¿ã€‚

:::warning  
å¦‚æœåœ¨ PowerShell ä¸­è¿è¡Œä¸€é”®å®‰è£…å‘½ä»¤æ—¶é‡åˆ°é”™è¯¯ï¼Œè¯·å°è¯•ä¸‹æ–¹çš„**åœ¨ Windows ä¸­æ‰‹åŠ¨å®‰è£… Agent**ã€‚  
:::  

## å…¶ä»–æ–¹å¼å®‰è£… Agent

### åœ¨ Linux ä¸­å®‰è£… Agentï¼ˆæ”¯æŒå¤§éƒ¨åˆ†å‘è¡Œç‰ˆï¼‰
<details>
  <summary>ç‚¹å‡»å±•å¼€/æ”¶èµ·</summary>

1. é¦–å…ˆåœ¨ç®¡ç†é¢æ¿ä¸­æ·»åŠ ä¸€å°æœåŠ¡å™¨ã€‚  
2. åœ¨è¢«æ§æœåŠ¡å™¨ä¸­ï¼Œè¿è¡Œè„šæœ¬ï¼ˆä½äºä¸­å›½å¤§é™†çš„æœåŠ¡å™¨è¯·ä½¿ç”¨é•œåƒï¼‰ï¼š

```bash
curl -L https://raw.githubusercontent.com/nezhahq/scripts/main/install.sh -o nezha.sh && chmod +x nezha.sh && sudo ./nezha.sh
```

å¦‚æœä½ çš„è¢«æ§æœåŠ¡å™¨ä½äºä¸­å›½å¤§é™†ï¼Œå¯ä»¥ä½¿ç”¨é•œåƒï¼š

```bash
curl -L https://gitee.com/naibahq/scripts/raw/main/install.sh -o nezha.sh && chmod +x nezha.sh && sudo CN=true ./nezha.sh
```

3. é€‰æ‹©â€œå®‰è£…ç›‘æ§ Agentâ€ã€‚  
4. è¾“å…¥é€šä¿¡åŸŸåï¼Œå¦‚ï¼šâ€data.example.comâ€œã€‚  
5. è¾“å…¥é¢æ¿é€šä¿¡ç«¯å£ï¼ˆgRPC ç«¯å£ï¼‰ï¼Œé»˜è®¤ä¸º 5555ã€‚  
6. è¾“å…¥ Agent å¯†é’¥ï¼ŒAgent å¯†é’¥åœ¨ç®¡ç†é¢æ¿ä¸­æ·»åŠ æœåŠ¡å™¨æ—¶ç”Ÿæˆï¼Œå¯ä»¥åœ¨ç®¡ç†é¢æ¿ä¸­çš„â€œæœåŠ¡å™¨â€é¡µä¸­æ‰¾åˆ°ã€‚  
7. ç­‰å¾…å®‰è£…å®Œæˆåè¿”å› Dashboard ä¸»é¡µæŸ¥çœ‹æœåŠ¡å™¨æ˜¯å¦ä¸Šçº¿ã€‚

</details>

### ä½¿ç”¨ Agent å†…ç½®æœåŠ¡å‘½ä»¤å®‰è£…ï¼ˆæ”¯æŒä¸»æµç³»ç»Ÿï¼‰
<details>
  <summary>ç‚¹å‡»å±•å¼€/æ”¶èµ·</summary>

é¦–å…ˆè·å– Agent çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼šhttps://github.com/nezhahq/agent/releases

è§£å‹åè¾“å…¥ä»¥ä¸‹å‘½ä»¤å®‰è£…æœåŠ¡ï¼ˆå¯èƒ½éœ€è¦ root æƒé™ï¼‰ï¼š

```bash
./nezha-agent service install -s server_name:port -p password
```

é™¤äº†æœåŠ¡å™¨åœ°å€å’Œå¯†ç ï¼Œè¿˜å¯ä»¥æ·»åŠ å…¶å®ƒæ”¯æŒçš„å‚æ•°ã€‚å…·ä½“å‚è€ƒ[è‡ªå®šä¹‰ Agent ç›‘æ§é¡¹ç›®](/guide/q7.html)

å¸è½½æœåŠ¡ï¼š

```bash
./nezha-agent service uninstall
```

å¯åŠ¨æœåŠ¡ï¼š

```bash
./nezha-agent service start
```

åœæ­¢æœåŠ¡ï¼š

```bash
./nezha-agent service stop
```

é‡å¯æœåŠ¡ï¼š

```bash
./nezha-agent service restart
```

</details>

### runit å®‰è£… Agent
<details>
  <summary>ç‚¹å‡»å±•å¼€/æ”¶èµ·</summary>

ç›®å‰ Agent å†…ç½®çš„æœåŠ¡åŠŸèƒ½å·²ç»æ”¯æŒäº†ç»å¤§éƒ¨åˆ† init ç³»ç»Ÿï¼ŒåŒ…æ‹¬ FreeBSD rc.d å’Œ openrcã€‚å°½ç®¡å¦‚æ­¤è¿˜æ˜¯æœ‰ä¸€äº›æ¼ç½‘ä¹‹é±¼ã€‚

è¿™é‡Œä½¿ç”¨ Void Linux çš„ runit ä½œä¸ºç¤ºä¾‹ï¼š

1. åˆ›å»º `/etc/sv/nezha-agent` ç›®å½•ï¼š

```bash
mkdir /etc/sv/nezha-agent
```

2. åˆ›å»º `/etc/sv/nezha-agent/run` æœåŠ¡æ–‡ä»¶ï¼Œå†™å…¥ä»¥ä¸‹å†…å®¹ï¼š

```bash
#!/bin/sh
exec 2>&1
exec /opt/nezha/agent/nezha-agent -s server_name:port -p password 2>&1
```

è¿™é‡ŒåŒæ ·å¯ä»¥æ·»åŠ å…¶å®ƒå‚æ•°ã€‚

3. åˆ›å»º `/etc/sv/nezha-agent/log/run`ï¼š

```bash
#!/bin/sh
exec vlogger -t nezha-agent -p daemon
```

4. å¯ç”¨æœåŠ¡ï¼š

```bash
sudo ln -s /etc/sv/nezha-agent/ /var/service
```

ä¹‹åå¯ä»¥é€šè¿‡ `sv` å‘½ä»¤æ¥æ“ä½œæœåŠ¡ã€‚

å¦‚ä½•æŸ¥çœ‹æ—¥å¿—ï¼š

1. å®‰è£… `socklog`ï¼Œå¹¶å¯ç”¨ï¼š

```bash
sudo xbps-install -S socklog-void
sudo ln -s /etc/sv/socklog-unix /var/service
```

2. è¿è¡Œ `svlogtail` æŸ¥çœ‹æ—¥å¿—ï¼š

```bash
sudo svlogtail | grep nezha-agent
```

</details>

### åœ¨ Windows ä¸­æ‰‹åŠ¨å®‰è£… Agent
* è¯·å‚è€ƒç¤¾åŒºæ–‡ç« ï¼š  
[å“ªå’æ¢é’ˆ - Windows å®¢æˆ·ç«¯å®‰è£…](https://nyko.me/2020/12/13/nezha-windows-client.html)

### åœ¨ç¾¤æ™– DSM ä¸­å®‰è£… Agent
<details>
  <summary>ç‚¹å‡»å±•å¼€/æ”¶èµ·</summary>

* è¯·å‚è€ƒç¤¾åŒºæ–‡ç« ï¼š  
[ç¾¤æ™– DSM 7.x å®‰è£… å“ªå’ç›‘æ§ Agent](https://blog.mitsea.com/3929551d08bd4bb0a8baa453e2d92b0c/)  
[å“ªå’æ¢é’ˆâ€”â€”ç¾¤æ™–å®¢æˆ·ç«¯ï¼ˆè¢«æ§ç«¯ï¼‰å®‰è£…æ•™ç¨‹](https://wl.gta5pdx.cn/archives/546/)

* Systemd å®ç° *ä»…é€‚ç”¨äº DSM7*:

```sh
# Agent è·¯å¾„
EXEC="/PATH/TO/nezha-agent"
# æ—¥å¿—è·¯å¾„åœ°å€
LOG="${EXEC}.log"
# é¢å¤–æ‰§è¡Œå‚æ•°, å¯ç•™ç©º
ARGS=""
# å“ªå’æœåŠ¡ç«¯ gRPC åœ°å€
SERVER="HOST_OR_IP:gRPC_PORT"
# ä¸Šä¸€æ­¥è·å–çš„ä¸»æœºå¯†é’¥
SECRET="APP_SECRET"
# è¿è¡ŒæœåŠ¡çš„ç”¨æˆ·å, *å¼ºçƒˆå»ºè®®ä½¿ç”¨érootç”¨æˆ·æ‰§è¡Œ*
RUN_USER="nezha"

# å†™å…¥åˆ° systemd æœåŠ¡æ–‡ä»¶
cat << EOF > /usr/lib/systemd/system/nezha.service
[Unit]
Description=Nezha Agent Service
After=network.target

[Service]
Type=simple
ExecStart=/bin/nohup ${EXEC} ${ARGS} -s ${SERVER} -p ${SECRET} &>> ${LOG} &
ExecStop=ps -fe |grep nezha-agent|awk '{print \$2}'|xargs kill
User=${RUN_USER

}
Restart=on-abort

[Install]
WantedBy=multi-user.target
EOF

# é‡è½½æœåŠ¡
systemctl daemon-reload
# å¯åŠ¨æœåŠ¡
systemctl start nezha
# æœåŠ¡è‡ªå¯åŠ¨
systemctl enable nezha
```

â€¼ï¸ä¿®æ”¹å¯¹åº”ä¿¡æ¯åâ€¼ï¸  
ä½¿ç”¨ `root` è´¦å·æ‰§è¡Œä¸Šè¿°å‘½ä»¤å³å¯å®‰è£…å®Œæˆã€‚

</details>

### åœ¨ macOS ä¸­ä½¿ç”¨ Homebrew å®‰è£… Agent
<details>
  <summary>ç‚¹å‡»å±•å¼€/æ”¶èµ·</summary>

***æœ¬èŠ‚å†…å®¹æ”¹ç¼–è‡ª [ğŸ¿ï¸æ¾é¼ æ”¶é›†ğŸŒ°](https://blog.mre.red/archives/install_nezha_monitoring_agent_service_with_homebrew)ï¼Œæ”¹ç¼–å·²è·å¾—åŸä½œè€…æˆæƒ***

::: warning	
è¯·åŠ¡å¿…å…ˆæ·»åŠ ç¯å¢ƒå˜é‡ï¼Œå†é€šè¿‡ Homebrew å®‰è£… nezha-agentï¼
å›  Homebrew åœ¨è½¯ä»¶å®‰è£…æ—¶åˆ›å»ºæœåŠ¡æ‰€éœ€ plist æ–‡ä»¶ï¼Œè‹¥å…ˆå®‰è£…å†æ·»åŠ ç¯å¢ƒå˜é‡ï¼Œä¼šå› ç¼ºå°‘å‚æ•°è€Œå¯åŠ¨å¤±è´¥ã€‚
:::

1. æ·»åŠ ç¯å¢ƒå˜é‡ï¼š

```shell
echo 'export HOMEBREW_NEZHA_AGENT_PASSWORD="é€šä¿¡å¯†é’¥ï¼Œåœ¨æœåŠ¡é¡µé¢è·å–"' >> ~/.zshrc
echo 'export HOMEBREW_NEZHA_AGENT_SERVER="ä½ çš„æœåŠ¡å™¨å’Œç«¯å£ï¼Œæ ¼å¼ your.domain:5555 "' >> ~/.zshrc
source ~/.zshrc
```

2. å®‰è£… Nezha Agentï¼š

::: danger
è¯·æ³¨æ„ï¼Œæ­¤ Homebrew ä»“åº“ç”±ç¬¬ä¸‰æ–¹ç»´æŠ¤ï¼Œä¸å“ªå’ç›‘æ§æ— å…³ã€‚
Nezha é¡¹ç›®ç»„ä¸å¯¹è¯¥ä»“åº“çš„å¯ç”¨æ€§å’Œå®‰å…¨æ€§ç­‰æ–¹é¢ä½œå‡ºèƒŒä¹¦ã€‚åœ¨ä½¿ç”¨å‰ï¼Œè¯·è‡ªè¡Œè¯„ä¼°é£é™©ï¼
:::

ç”±äºæš‚æœªæäº¤åˆ° Homebrew Core å®˜æ–¹åº“ï¼Œæš‚æ—¶æ”¾åœ¨ä¸Šè¿°åšå®¢ä½œè€…å‚ä¸ç»´æŠ¤çš„ [ç¬¬ä¸‰æ–¹ Homebrew ä»“åº“](https://github.com/Brewforge/homebrew-chinese) ä¸­ï¼š

```shell
brew install brewforge/chinese/nezha-agent
```

3. é€šè¿‡ Homebrew å¯åŠ¨ Nezha Agent æœåŠ¡ï¼š

```shell
brew services start nezha-agent
```

4. æ£€æŸ¥æœåŠ¡çŠ¶æ€ï¼š

```shell
brew services info nezha-agent
```

5. åœæ­¢æœåŠ¡ï¼š

```shell
brew services stop nezha-agent
```

6. å¸è½½ Nezha Agentï¼š

```shell
brew rm nezha-agent
```

7. æŠ¥é”™æ—¶å…ˆæ£€æŸ¥ç¯å¢ƒå˜é‡ï¼š

```shell
echo $HOMEBREW_NEZHA_AGENT_PASSWORD
echo $HOMEBREW_NEZHA_AGENT_SERVER
```

8. è‹¥ç¯å¢ƒå˜é‡é…ç½®æ­£ç¡®ï¼Œå†å°è¯•é‡è£…ï¼š

```shell
brew services stop nezha-agent
brew reinstall nezha-agent
brew services start nezha-agent
```

9. è‹¥ä»æœªè§£å†³ï¼Œè¯·å‰å¾€ä¸Šè¿° [ç¬¬ä¸‰æ–¹ Homebrew ä»“åº“](https://github.com/Brewforge/homebrew-chinese) æäº¤ issueã€‚

</details>

### åœ¨ OpenWRT ä¸­å®‰è£… Agent
<details>
  <summary>ç‚¹å‡»å±•å¼€/æ”¶èµ·</summary>

**å¦‚ä½•ä¸€æ­¥åˆ°ä½ï¼Œè§£å†³å®‰è£…è¿‡ç¨‹ä¸­çš„ç–‘éš¾æ‚ç—‡ï¼Ÿ**

* è¯·å‚è€ƒé¡¹ç›®ï¼š  
[NZ-OpenWrt](https://github.com/dysf888/NZ-OpenWrt)  

**å¦‚ä½•ä½¿æ—§ç‰ˆ OpenWRT/LEDE è‡ªå¯åŠ¨ï¼Ÿ**

* è¯·å‚è€ƒé¡¹ç›®ï¼š  
[å“ªå’ç›‘æ§ For OpenWRT](https://github.com/Erope/openwrt_nezha)  

**å¦‚ä½•ä½¿æ–°ç‰ˆ OpenWRT è‡ªå¯åŠ¨ï¼Ÿ è´¡çŒ®è€…ï¼š@è‰¾æ–¯å¾·æ–¯**

* é¦–å…ˆåœ¨ release ä¸‹è½½å¯¹åº”çš„äºŒè¿›åˆ¶è§£å‹ zip åŒ…åæ”¾ç½®åˆ° `/root`ã€‚  
* è¿è¡Œ `chmod +x /root/nezha-agent` èµ‹äºˆæ‰§è¡Œæƒé™ï¼Œç„¶ååˆ›å»º `/etc/init.d/nezha-service`ï¼š

```shell
#!/bin/sh /etc/rc.common

START=99
USE_PROCD=1

start_service() {
 procd_open_instance
 procd_set_param command /root/nezha-agent -s é¢æ¿é€šä¿¡åœ°å€:ç«¯å£ -p ç§˜é’¥ -d
 procd_set_param respawn
 procd_close_instance
}

stop_service() {
  killall nezha-agent
}

restart() {
 stop
 sleep 2
 start
}
```

* è¿è¡Œ `chmod +x /etc/init.d/nezha-service` èµ‹äºˆæ‰§è¡Œæƒé™ã€‚  
* å¯åŠ¨æœåŠ¡ï¼š `/etc/init.d/nezha-service enable && /etc/init.d/nezha-service start`

</details>

## Agent æœ‰ Docker é•œåƒå—ï¼Ÿ

**Agent ç›®å‰æ²¡æœ‰æ¨å‡º Docker é•œåƒã€‚**  
Agent çš„è®¾è®¡æ€è·¯å’Œ Dashboard ç›¸åï¼ŒDashboard è¦å°½å¯èƒ½ä¸å½±å“å®¿ä¸»æœºå·¥ä½œï¼Œä½† Agent åˆ™éœ€è¦åœ¨å®¿ä¸»æœºä¸­æ‰§è¡Œç›‘æ§æœåŠ¡å’Œè¿è¡Œå‘½ä»¤ã€‚  
å°† Agent æ”¾å…¥å®¹å™¨ä¸­ç¡®å®å¯ä»¥ç»§ç»­æ‰§è¡Œç›‘æ§ä»»åŠ¡ï¼Œä½† WebShell ç­‰åŠŸèƒ½æ— æ³•æ­£å¸¸è¿è¡Œï¼Œå› æ­¤ä¸æä¾› Docker é•œåƒã€‚