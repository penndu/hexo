---
title: LVS 的算法
tags:
  - 分发
categories:
  - 运维教程
date: 2019-11-02 00:00:00
---

> LVS 在做分发时，根据不同情况，包括前端请求类型，后端应用及服务器类型，需要有不同的分发方式，这就是 LVS 算法，今天杜老师为大家讲讲都有哪些算法！

<!-- more -->

## 演示效果

效果如图：

{% gallery %}
![](https://cdn.dusays.com/2019/10/112-2.jpg)
{% endgallery %}

## 算法列表

算法列表如下：

| 算法 | 名称 | 作用 |
| - | - | - |
| rr | 轮询调度 | 第一个请求交给 RS1，第二个请求交给 RS2，第三个请求交给 RS1，以此类推，如果两个机器一个小霸王一个至强就有问题了 |
| wrr | 加权轮询 | 加上权重，也就是比例值，如 RS1=2/RS2=1，就是说访问的过程为 112 |
| lc | 最少链接 | 类似于 rr，找当前链接数最少的服务器进行连接 |
| wlc | 加权最少链接 | 如果出现多台链接数最少的情况，则根据权重来决定 |
| lblc | 基于局部最少链接 | 比如一个公司 100 台机器的集群中有 10 台北京服务器，北京的用户进来会从这 10 台服务器中进行最少链接调度 |
| sh | 来源地址散列 | 来源地址不变，则分发的后端机器不变 |
| dh | 目的地址散列 | 目的地址不变，则分发的机器不变 |

## 散列算法

散列计算是根据 IP 数字，去掉点除以 RS 数量，根据余数判断请求交给哪一台服务器。

源地址散列调度算法根据请求的源 IP 地址，作为散列键从静态分配的散列表找出对应的服务器，若该服务器是可用且未超载，将请求发送到该服务器｡

目的地址散列根据请求的目标 IP 地址，作为散列键从静态分配的散列表找出对应的服务器，若该服务器是可用且未超载，将请求发送到该服务器。

对于 FTP 这种的服务，如果使用类似轮询方法，建立传输通道之后，传输数据可能会去另一台机器取数据，但是与另一台机器没有建立链接，不能传输。

## 算法应用

应用列表：

| 算法 | 应用 |
| - | - |
| rr/wrr/lc/wlc | 适用静态请求 |
| lblc/sh/dh | 适用动态请求，例如网游，连上服务器后不能随便切换 |