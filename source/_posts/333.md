---
title: 去不图床网站架构
tags:
  - 架构
categories:
  - 运维教程
date: 2021-04-19 00:00:00
---

> 最近调整了去不图床的网站架构，保障平稳运行的同时降低运营的成本，此文做记录的同时也向大家分享一下目前架构，如有建议欢迎在评论区留言！

<!-- more -->

## 网站架构

去不图床网站架构：

{% gallery %}
![](https://cdn.dusays.com/2021/04/333-1.jpg)
{% endgallery %}

## 数据走向

访客通过互联网将请求发送至域名解析服务器，图床的 DNS 为 Cloudflare「以下简称为 CF」CF 已开启缓存功能，会优先查找对应的缓存数据，如未找到缓存数据，则请求 ECS 中运行的网站数据。

当访客上传图片时，通过 ECS 将数据保存至 OSS，并返回图片的访问地址。

当访客通过外链访问图片数据时，CF 优先查找对应的缓存数据，如未找到缓存数据，则请求 CDN 中的缓存数据。

如 CDN 中未找到缓存数据，则从 OSS 中调用图片数据，同时进行图片鉴黄操作，最后将数据传输给访客。

## 架构优点

CF 可以隐藏后端服务器的真实 IP，保护 ECS 不被 DDoS，同时 CF 的缓存功能可以降低后端负载，且降低 OSS/CDN 因流量产生的费用。

ECS 通过内网连接 OSS，提升传输速率同时，降低因流量产生的费用「内网流量免费」

## 架构缺点

服务节点较多，获取图片数据需经过三个节点，且三节点不在同一地域，跨域访问会影响传输的速率。

阿里云的 CDN 图片鉴黄功能非实时拦截，需人工做图片拦截操作。
